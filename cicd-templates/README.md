# CI/CD Pipeline Templates for Genkit

Production-ready CI/CD pipeline templates for Firebase Genkit applications across multiple platforms.

## üìã Overview

This directory contains comprehensive CI/CD pipeline templates for deploying Genkit applications to various cloud platforms with best practices built-in.

## üöÄ Available Templates

### Platform Templates
- **GitHub Actions** - Complete workflows for GitHub repositories
- **GitLab CI** - GitLab CI/CD pipeline configurations
- **Azure Pipelines** - Azure DevOps pipeline templates
- **CircleCI** - CircleCI configuration files
- **Jenkins** - Jenkinsfile templates

### Deployment Targets
- ‚úÖ Firebase Cloud Functions
- ‚úÖ Google Cloud Run
- ‚úÖ Google Cloud Functions (2nd gen)
- ‚úÖ Vercel
- ‚úÖ AWS Lambda
- ‚úÖ Docker / Kubernetes
- ‚úÖ Self-hosted servers

## üéØ Features

All templates include:

- ‚úÖ **Multi-environment support** (dev, staging, production)
- ‚úÖ **Automated testing** (unit, integration, e2e)
- ‚úÖ **Security scanning** (dependencies, secrets, SAST)
- ‚úÖ **Code quality checks** (linting, formatting, type checking)
- ‚úÖ **Build optimization** (caching, parallel jobs)
- ‚úÖ **Deployment strategies** (blue-green, canary, rolling)
- ‚úÖ **Rollback mechanisms** (automatic on failure)
- ‚úÖ **Notifications** (Slack, Discord, email)
- ‚úÖ **Monitoring integration** (health checks, metrics)
- ‚úÖ **Secret management** (secure API keys, tokens)
- ‚úÖ **Branch protection** (main, develop, release branches)
- ‚úÖ **Semantic versioning** (automatic version bumps)
- ‚úÖ **Changelog generation** (automated release notes)

## üìÅ Template Structure

```
cicd-templates/
‚îú‚îÄ‚îÄ github-actions/
‚îÇ   ‚îú‚îÄ‚îÄ firebase-functions.yml
‚îÇ   ‚îú‚îÄ‚îÄ cloud-run.yml
‚îÇ   ‚îú‚îÄ‚îÄ vercel.yml
‚îÇ   ‚îú‚îÄ‚îÄ aws-lambda.yml
‚îÇ   ‚îú‚îÄ‚îÄ docker.yml
‚îÇ   ‚îú‚îÄ‚îÄ multi-environment.yml
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ gitlab-ci/
‚îÇ   ‚îú‚îÄ‚îÄ .gitlab-ci.yml
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ azure-pipelines/
‚îÇ   ‚îú‚îÄ‚îÄ azure-pipelines.yml
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ circleci/
‚îÇ   ‚îú‚îÄ‚îÄ config.yml
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ jenkins/
‚îÇ   ‚îú‚îÄ‚îÄ Jenkinsfile
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ README.md (this file)
```

## üîß Quick Start

### 1. Choose Your Platform

Select the CI/CD platform you're using:
- [GitHub Actions](./github-actions/README.md) - Most popular
- [GitLab CI](./gitlab-ci/README.md) - GitLab users
- [Azure Pipelines](./azure-pipelines/README.md) - Azure DevOps
- [CircleCI](./circleci/README.md) - CircleCI users
- [Jenkins](./jenkins/README.md) - Self-hosted CI/CD

### 2. Choose Your Deployment Target

Each platform has templates for different deployment targets:
- Firebase Cloud Functions
- Google Cloud Run
- Vercel
- AWS Lambda
- Docker/Kubernetes

### 3. Copy Template to Your Project

```bash
# Example: Copy GitHub Actions template for Firebase Functions
cp cicd-templates/github-actions/firebase-functions.yml .github/workflows/deploy.yml

# Configure secrets in your repository settings
# Update environment variables
# Commit and push
```

### 4. Configure Secrets

Each template requires specific secrets. See platform-specific README for details.

**Common secrets:**
- `ANTHROPIC_API_KEY` - Claude API key
- `GOOGLE_AI_API_KEY` - Gemini API key
- `FIREBASE_TOKEN` - Firebase deployment token
- `GCP_SERVICE_ACCOUNT_KEY` - Google Cloud credentials

### 5. Test Your Pipeline

```bash
# Trigger the pipeline
git add .
git commit -m "chore: add CI/CD pipeline"
git push origin main

# Watch the pipeline run in your CI/CD platform
```

## üìä Pipeline Workflows

### Development Workflow
```
Pull Request ‚Üí Run Tests ‚Üí Code Quality ‚Üí Security Scan ‚Üí Preview Deploy
```

### Staging Workflow
```
Merge to develop ‚Üí Build ‚Üí Test ‚Üí Deploy to Staging ‚Üí Integration Tests
```

### Production Workflow
```
Merge to main ‚Üí Build ‚Üí Test ‚Üí Security Scan ‚Üí Deploy to Production ‚Üí Health Check ‚Üí Notify
```

## üîê Security Best Practices

### Secret Management
- ‚úÖ Use platform secret management (GitHub Secrets, etc.)
- ‚úÖ Never commit secrets to git
- ‚úÖ Rotate secrets regularly
- ‚úÖ Use least-privilege access
- ‚úÖ Audit secret usage

### Dependency Security
- ‚úÖ Automated dependency scanning
- ‚úÖ Vulnerability alerts
- ‚úÖ Automatic security updates
- ‚úÖ License compliance checks

### Code Security
- ‚úÖ SAST (Static Application Security Testing)
- ‚úÖ Secret scanning in code
- ‚úÖ Container security scanning
- ‚úÖ Infrastructure as Code scanning

## üé® Deployment Strategies

### Blue-Green Deployment
Deploy new version alongside old version, switch traffic when ready.

**Benefits:**
- Zero downtime
- Easy rollback
- Full testing in production environment

**Use cases:**
- Production deployments
- Critical applications
- High-availability requirements

### Canary Deployment
Gradually roll out to subset of users, monitor, then full rollout.

**Benefits:**
- Risk mitigation
- Real-world testing
- Gradual rollout

**Use cases:**
- Large user bases
- High-risk changes
- Performance testing

### Rolling Deployment
Replace instances one at a time.

**Benefits:**
- Resource efficient
- Continuous availability
- Simple implementation

**Use cases:**
- Standard deployments
- Kubernetes environments
- Microservices

## üìà Monitoring & Observability

### Health Checks
All templates include health check endpoints:
```typescript
// src/health.ts
export const healthCheck = defineFlow({
  name: 'health',
  inputSchema: z.object({}),
  outputSchema: z.object({
    status: z.enum(['healthy', 'degraded', 'unhealthy']),
    version: z.string(),
    timestamp: z.string(),
  }),
}, async () => {
  return {
    status: 'healthy',
    version: process.env.APP_VERSION || '1.0.0',
    timestamp: new Date().toISOString(),
  };
});
```

### Metrics Integration
- Request count
- Error rate
- Response time
- Resource usage
- API quotas

### Logging
- Structured logging
- Log aggregation
- Error tracking
- Audit trails

## üîî Notifications

Configure notifications for:
- ‚úÖ Deployment success/failure
- ‚úÖ Test failures
- ‚úÖ Security vulnerabilities
- ‚úÖ Performance issues
- ‚úÖ Error rate spikes

**Supported channels:**
- Slack
- Discord
- Microsoft Teams
- Email
- SMS
- PagerDuty

## üß™ Testing Strategy

### Unit Tests
```bash
npm test
```

### Integration Tests
```bash
npm run test:integration
```

### End-to-End Tests
```bash
npm run test:e2e
```

### Performance Tests
```bash
npm run test:performance
```

### Security Tests
```bash
npm audit
npm run test:security
```

## üîÑ Rollback Procedures

### Automatic Rollback
All templates include automatic rollback on:
- Health check failures
- Error rate threshold exceeded
- Performance degradation
- Manual trigger

### Manual Rollback
```bash
# Using Firebase
firebase functions:config:set version=1.0.0
firebase deploy --only functions

# Using Cloud Run
gcloud run services update SERVICE_NAME \
  --revision-suffix=v1-0-0 \
  --traffic=v1-0-0=100

# Using Vercel
vercel rollback
```

## üìù Environment Variables

### Required
```bash
NODE_ENV=production
APP_VERSION=1.0.0
LOG_LEVEL=info
```

### AI Model Keys
```bash
ANTHROPIC_API_KEY=sk-ant-...
GOOGLE_AI_API_KEY=AIza...
OPENAI_API_KEY=sk-...
```

### Platform-Specific
```bash
# Firebase
FIREBASE_PROJECT_ID=my-project
FIREBASE_TOKEN=...

# Google Cloud
GCP_PROJECT_ID=my-project
GCP_REGION=us-central1

# Vercel
VERCEL_TOKEN=...
VERCEL_ORG_ID=...
VERCEL_PROJECT_ID=...
```

## üéì Platform-Specific Guides

### [GitHub Actions](./github-actions/README.md)
- Complete workflow files
- Reusable workflows
- Custom actions
- Matrix builds
- Secrets management

### [GitLab CI](./gitlab-ci/README.md)
- Pipeline configuration
- Job templates
- Variables
- Environments
- Deployment strategies

### [Azure Pipelines](./azure-pipelines/README.md)
- YAML pipelines
- Classic pipelines
- Variable groups
- Service connections
- Release management

### [CircleCI](./circleci/README.md)
- Config version 2.1
- Orbs
- Workflows
- Contexts
- Docker layer caching

### [Jenkins](./jenkins/README.md)
- Declarative pipelines
- Scripted pipelines
- Shared libraries
- Credentials
- Build agents

## üîß Customization

### Modify Environment Variables
```yaml
env:
  NODE_ENV: production
  APP_VERSION: ${{ github.sha }}
  CUSTOM_VAR: your-value
```

### Add Custom Steps
```yaml
- name: Custom Step
  run: |
    echo "Your custom commands"
    npm run custom-script
```

### Change Deployment Target
Update the deployment section with your target platform configuration.

### Add Notifications
```yaml
- name: Notify on success
  if: success()
  uses: slackapi/slack-github-action@v1
  with:
    payload: |
      {
        "text": "Deployment successful! üéâ"
      }
```

## üìä Cost Optimization

### Build Optimization
- Use caching for dependencies
- Parallel job execution
- Incremental builds
- Build artifacts reuse

### Deployment Optimization
- Cold start reduction
- Resource right-sizing
- Regional deployment
- Traffic-based scaling

### Monitoring Optimization
- Log sampling
- Metric aggregation
- Alert tuning
- Cost anomaly detection

## ü§ù Contributing

Want to add a template or improve existing ones?

1. Fork the repository
2. Create a feature branch
3. Add your template with documentation
4. Test thoroughly
5. Submit a pull request

## üìö Resources

- [Genkit Documentation](https://genkit.dev/docs/get-started/)
- [Firebase CI/CD](https://firebase.google.com/docs/hosting/github-integration)
- [Cloud Run CI/CD](https://cloud.google.com/run/docs/continuous-deployment)
- [GitHub Actions](https://docs.github.com/actions)
- [GitLab CI](https://docs.gitlab.com/ee/ci/)
- [Azure Pipelines](https://docs.microsoft.com/azure/devops/pipelines/)
- [CircleCI](https://circleci.com/docs/)
- [Jenkins](https://www.jenkins.io/doc/)

## üÜò Support

- üêõ **Issues**: [GitHub Issues](https://github.com/amitpatole/claude-genkit-plugin/issues)
- üí¨ **Discussions**: [GitHub Discussions](https://github.com/amitpatole/claude-genkit-plugin/discussions)
- üìß **Email**: amit.patole@gmail.com

## üìÑ License

MIT License - see [LICENSE](../LICENSE) file for details

---

**Ready to deploy?** Choose your platform above and follow the quickstart guide! üöÄ
